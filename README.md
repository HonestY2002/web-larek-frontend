# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
- src/utils/items.ts — файл c массивом объектов товаров

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

1. Это объект который мы получаем с сервера. Мы не можем редактировать эти данные, но можем отображать объект используя эти данные interface Product { id: string; description: string; image: string; title: string; category: string; price: number;} 
 
2. Это пустой объект корзина, мы можем удалять и добалять товар в корзину, выбирать товар по id. interface  Basket предназначен для определения структуры и поведения объекта который будет использоваться в коде. Также в интерфейсе Basket будут храниться элементы массива items, каждый из которых является объектом Product. Методы addProduct и deleteProduct позволяют соответственно добавить продукт в корзину и удалить его.

3. interface ProductData  {это данные товаров, а также действия которые мы можем выполнять products: Product[]; preview: string | null;  это указатель на товар который мы хотим 
посмотреть getProduct(productId: string): Product;}
 
4. Это даннные пользователя которые будут вноситься в форму, валидироваться и сохраняться в модели данных.
interface UserData {payment: string; address: string; email: string; phone: string;  addData() добавляем данные в объект заказа checkValidation(data: Record<keyof OrderFormData, string>): boolean; делаем валидацию}

5. Это пустой объект заказа который мы будем отправлять на сервер interface Order {payment: string; email: string; phone: string; address: string;}

6. type PageProduct = Pick<Product, 'image' | 'title' | 'category' | 'price'> - позволяет получить данные о продукте, включая изображение, название, категорию, цену
    
7. type ProductPopup = Pick<Product, 'image' | 'title' | 'category' | 'price' | 'description'> - позволяет получить данные о продукте, включая изображение, название, категорию, цену и описание
    
8. type AddProduct = Pick<Product, 'id' | 'title' | 'price' > - Позволяет получить данные о продукте по его идентификатору и сохранить их в типе данных, который определяет свойства продукта
     
9. type ProductOrderPrice = Pick<Product, 'price'> - Здесь должна быть цена выбранного товара
    
10. type OrderFormData = Pick<Order, 'payment' | 'address' | 'email' | 'phone'> - Данные, вводимые в формы при оформлении заказа
    
11. type OrderProducts = Pick<Order, 'items'> - Список товаров, добавленных в корзину

12. type FormErrors = Partial<Record<keyof  UserData, string>>;

## Архетиктура приложения

* Model (Модель) - часть приложения, которая работает с данными, проводит вычисления и руководит всеми бизнес-процессами.
* View (Вид или представление) - часть приложения, показывающая пользователю интерфейс и данные из модели на экране.
* Presenter (Представитель) - часть приложения, которая обеспечивает связь, является посредником между моделью и видом.

### Базовый код

#### Класс Api
     
В данном случае конструктор класса Api принимает два параметра: 
 * baseUrl: string — базовый URL для взаимодействия с API. 
 * options: RequestInit = {} — дополнительные параметры конфигурации запроса.

Поля класса
* readonly baseUrl: string — базовый URL для запросов.
* protected options: RequestInit — параметры запроса, такие как заголовки и метод.

Конструктор
Создаёт экземпляр класса с заданным базовым URL и параметрами запроса. Если параметр options не указан, используются значения по умолчанию: constructor(baseUrl: string, options: RequestInit = {})

В данном случае конструктор класса Api принимает два параметра: 
 * baseUrl: string — базовый URL для взаимодействия с API. 
 * options: RequestInit = {} — дополнительные параметры конфигурации запроса.
   
Метод handleResponse
Обрабатывает ответ от сервера. Если ответ успешный, возвращает ответ в формате JSON. Если нет, пытается получить ошибку из ответа и возвращает её или статус ответа в виде строки.

#### Класс EventEmitter

    Брокер событий, классическая реализация. В расширенных вариантах есть возможность подписаться на все события или слушать события по шаблону. Основные методы, реализуемые классом, описаны интерфейсом 'IEvents':

    interface IEvents {
        on(event: EventName, callback: (data: T) => void): void;
        emit<T extends object>(event: string, data?: T): void;
        trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}

### Model

#### ProductData
Класс отвечает за хранение и логику работы с данными товаров, отображаемых на странице и добавляемых в корзинку.
Конструктор класса принимает инстант брокера событий.
В полях класса хранятся следующие данные:

В данном классе определены следующие поля и методы:

* Поле _products: массив объектов Product.
* Поле _preview: строка или null.
* Поле events: экземпляр интерфейса IEvents.

Методы класса:

* Конструктор: принимает аргумент events типа IEvents и присваивает его полю events.
* Метод set products: принимает аргумент products, который является массивом объектов Product, и присваивает его полю _products. Затем вызывает метод emit интерфейса events с аргументом 'products:changed'.
* Метод get products: возвращает значение поля _products.
* Метод getProduct: принимает строковый аргумент productId и возвращает объект Product из массива _products, идентификатор которого совпадает с переданным аргументом.
* Метод set preview: устанавливает значение поля _preview в зависимости от переданного аргумента productId. Если productId равен null, то поле _preview устанавливается в значение null. В противном случае метод вызывается метод getProduct с аргументом productId, выбирается соответствующий объект из массива _products и присваивается значение его идентификатора полю _preview.


#### Класс OrderData

Класс отвечает за хранение и логику работы с данными товаров, добавленных в корзину.
Данные товаров - это массив объектов товаров, их можно добавлять и удалять, а также подсчитывать общую стоимость товаров, добавленных в корзину.
Конструктор класса принимает брокер событий.

Конструктор: принимает аргумент events типа IEvents и присваивает его полю events.

В данном классе определены следующие поля и методы:

* Поле _basket: массив объектов Product.
* Поле userPayment: объект типа UserPayments, содержащий информацию о платеже (payment, address).
* Поле userContacts: объект типа UserContacts, содержащий контактную информацию пользователя (email, phone).
* Поле preview: строка или null.
* Поле formErrors: объект типа FormErrors, который содержит информацию об ошибках в форме.
* Поле events: экземпляр интерфейса IEvents.

Методы класса:

* Метод set basket: принимает аргумент basket и устанавливает значение поля _basket.
* Методы get basket, addProduct: обеспечивают доступ к полю _basket и добавляют продукт в корзину соответственно.
* Метод getTotal: возвращает количество продуктов в корзине.
* Метод totalPrice: возвращает общую стоимость продуктов в корзине.

### View

Все классы представляния отвечают за отображения внутри контейнера DOM-Element передаваемых в них данных.

#### Класс Component

Класс Component содержит защищённое свойство element, которое является элементом, с которым будет работать компонент. Также класс содержит метод render(), который должен быть реализован в каждом классе-наследнике. Все классы наследуются от Component.

#### Класс Modаls
Данный класс Modal расширяет класс Component. Он используется для создания модальных окон в приложении.
Класс имеет следующие свойства:

protected _closeButton: HTMLButtonElement: кнопка закрытия модального окна;
protected _content: HTMLElement: содержимое модального окна.

В конструкторе класса происходит инициализация свойств и обработчиков событий. Обработчик события нажатия на кнопку закрытия модального окна позволяет закрыть его при клике на эту кнопку. Обработчик событий щелчка по контейнеру модального окна закрывает его при любом клике по этому контейнеру. Обработчик клика по содержимому модального окна предотвращает всплытие этого события.

Метод open() добавляет к контейнеру модального окна класс, который делает окно видимым. Метод close() удаляет этот класс, делает содержимое окна равным null и генерирует событие закрытия модального окна.

Внутри может находиться:

* div class="modal__container
* div class="card card_full карточка с полным описанием товара и - кнопка в корзину
* div class="basket" - корзина со всеми выбранными товарами и кнопка оформить
* form class="form"> - форма заполнения данных покупателя и кнопка далее
* form class="form"> - форма заполнения данных покупателя и кнопка оплатить
* div class="order-success"> - извещение об успешном оформлении заказа и кнопка перехода на главную страницу

Реализация происходит путем вставления в модальное окно таких шаблонов как:

* template id="success">
* template id="card-catalog">
* template id="card-preview">
* template id="card-basket">
* template id="basket">
* template id="order">
* template id="contacts"> - по нажатию определенной кнопки пользователем открываеться модальное окно в котором находиться DOM-element, так реализуется метод открытия модального окна(open)

#### Класс BascketElement

Класс представляет собой компонент, который используется для управления корзиной товаров в приложении. Он обеспечивает взаимодействие с элементами интерфейса, такими как список товаров в корзине (list), общий счёт (total), кнопка оформления заказа (button) и кнопка открытия формы оплаты (orderButton).
Класс также позволяет устанавливать и изменять содержимое корзины (items), а также отображать общую стоимость товаров (total).

Конструктор: принимает аргумент container типа HTMLElement и присваивает его полю this.container. Также принимает аргумент events типа IEvents и присваивает его полю events.

В данном классе определены следующие поля и методы:

* Поле _list: экземпляр HTMLElement.
* Поле _total: экземпляр HTMLElement.
* Поле _button: экземпляр HTMLElement.
* Поле _orderButton: экземпляр HTMLButtonElement.
* Поле items: массив объектов HTMLElement.
* Поле total: числовое значение.
* Поле events: экземпляр интерфейса IEvents.

Методы класса:

* Метод set items: принимает значение массива объектов HTMLElement, которое присваивается полю items.
* Методы get _list, get _total, get _button, get _orderButton обеспечивают доступ к соответствующим полям.
* Метод ensureElement: проверяет наличие элемента в контейнере и при необходимости добавляет его.
* Метод replaceChildren: заменяет все дочерние элементы элемента на предоставленные.
* Метод getText: устанавливает текст элемента.

#### Класс Cards

Данный класс Cards расширяет класс Component. Он используется для создания компонентов, которые представляют карточки товаров в магазине. 
 
Класс имеет следующие свойства: 

* protected _catalog: HTMLElement: представляет контейнер с карточками товаров; 
* protected _totalBasket?: HTMLElement: элемент, отображающий общую стоимость товаров в корзине; 
* protected _button?: HTMLButtonElement: кнопка для оформления заказа, если она присутствует. 
 
В конструкторе класса происходит инициализация свойств и обработчика события нажатия на кнопку. 
Метод set catalog(items: HTMLElement[]) заменяет содержимое контейнера с карточками товарами на элементы из массива items. 

#### Класс ContactsForm

Класс представляет собой компонент, который используется для создания формы контактов. Он расширяет базовый класс FormPayment и позволяет пользователю вводить свои контактные данные, такие как телефон и адрес электронной почты

Класс имеет следующие поля и методы: 

* Поле container типа HTMLFormElement. 
* Поле events типа IEvents.

Также класс ContactsForm, как и класс FormPayment, имеет конструктор. В конструкторе класса ContactsForm происходит присвоение полей container и events.
Помимо этого, класс ContactsForm содержит методы set phone и set email. Эти методы устанавливают значения полей phone и email в соответствующие поля формы.

#### Класс CountInBasket

Класс  представляет собой компонент, который используется для отображения количества товаров в корзине. Он расширяет базовый класс Component и позволяет отображать количество товаров в корзине на странице.

Основные поля класса: 

* Поле _counter типа HTMLElement. 
* Поле events типа IEvents.

Методы класса: 

* Конструктор: принимает аргументы container и events, а затем присваивает их полю this.container и свойству events. Затем конструктор проверяет наличие элемента в контейнере с классом header__basket-counter. Если элемент найден, он присваивается полю _counter. 
* Метод set counter: устанавливает значение поля _counter.

#### Класс FormPayment

 Это класс, который представляет собой компонент формы оплаты. Он расширяет базовый класс Component и позволяет пользователю вводить данные для оплаты заказа.

Конструктор: принимает аргументы container и events, а затем присваивает их полю this.container и свойству events. Затем конструктор проверяет наличие элемента в контейнере с классом button[type=submit] и .form__errors. Если элемент найден, он присваивается полю _submit и полю _errors соответственно.

Класс FormPayment имеет следующие поля и методы: 

* Поле container типа HTMLFormElement. 
* Поле events типа IEvents. 
* Поля submit и errors типов HTMLButtonElement и HTMLElement.

Методы класса: 
* Метод set valid: устанавливает значение поля valid.
* Метод set errors: устанавливает значение поля errors.
* Метод render: принимает аргумент state типа Partial<T> & FormState и возвращает значение поля container.

#### Класс Page

Это класс, который представляет собой компонент страницы веб-сайта. Он расширяет базовый класс Component и позволяет пользователю взаимодействовать с элементами страницы.

Конструктор: принимает аргументы container и events, а затем присваивает их полю this.container и свойству events. Затем конструктор проверяет наличие элемента в контейнере с классом page__wrapper. Если элемент найден, он присваивается полю _wrapper. Также конструктор ищет элемент header__basket и присваивает его полю _basket.

Класс Page имеет следующие поля и методы: 

* Поле container типа HTMLElement. 
* Поле events типа IEvents. 
* Поля wrapper и basket типов HTMLElement.

Методы класса: 

*Метод set locked: устанавливает значение поля locked.

#### Класс Payment

Это класс, который представляет собой компонент формы оплаты. Он расширяет базовый класс FormPayment и позволяет пользователю выбирать способ оплаты: наличными или картой.

Конструктор: принимает аргументы container и events, а затем присваивает их полю this.container и свойству events. Затем конструктор проверяет наличие элемента в контейнере с классом button[type=submit] и .form__errors. Если элемент найден, он присваивается полю _submit и полю _errors соответственно. 

Класс Payment имеет следующие поля и методы: 

* Поле container типа HTMLFormElement. 
* Поля address и payment типа string.

Методы класса: 

* Метод set address: устанавливает значение поля address. 
* Метод set payment: устанавливает значение поля payment.

#### Класс ProductCard

Это класс, который представляет собой компонент для отображения карточки товара. Он расширяет базовый класс Component.

Конструктор: принимает аргументы container, events, присваивает их полю this.container и свойству events. Затем конструктор проверяет наличие элемента в контейнере с классом card__item-delete, а также .button.card__button. Если элемент найден, он присваивается полю _deleteButton и полю _basketButton соответственно. Также конструктор проверяет наличие элементов card__title, card__price, card__image, card__category и card__text. Для каждого из них он присваивает полям класса соответствующий элемент.

Класс имеет следующие поля и методы:

* Поле events типа IEvents.

* Поля image, category, title, description, price, id, ordered, deleteButton, basketButton, product и index типа string или number.

* Методы set image, set category, setTitle, set description, set price, setOnOrder, set index, set id, render, updateBasketButtonState, deleteCard, setText.

#### Класс Success

Это класс, который представляет собой компонент для отображения успешного результата операции. Он расширяет базовый класс Component.

Класс имеет следующие поля и методы:

* Поле actions типа SuccessActions.
* Поля close и total типа string или number.

Конструктор: принимает аргументы container и actions, а затем присваивает их полю this.container и свойству actions. Затем конструктор проверяет наличие элемента в контейнере с классом .order-success__close. Если элемент найден, он присваивается полю close.

### Presenter

#### Класс AppData

Класс принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

**Список всех событий, которые могут генерироваться в системе:**
События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представления):
Событие клика по карточке товара: 
* product:open - выбор товара для просмотра в модальном окне
* product:select - добавление товара в корзину 

Событие клика по кнопке купить: 
*  product:add - добавляет товар для покупки

Событие клика по корзине на Главной странице:
* basket:select - открываем корзину для просмотра 
* basket:changed - изменение массива товаров в корзине 

События клика редактировария заказа:
* orderFormFirst:open - открытие первого модального окна с формой редактирования заказа
* orderFormSecond:open - открытие второго модального окна с формой редактирования заказа
* order:changed - изменение данных заказа
* order:submit - сохранение заказа по нажатию кнопки оплатить
* orderForm:clear - необходима очистка данных, введенных в форму

События клика для изменения данных в форме:
* address:input - изменение данных в форме с данными адреса
* email:input - изменение данных в форме с данными почты
* phone:input - изменение данных в форме с данными телефона

Событие клика для выбора сбособа оплаты:
* payWay:select - выбор способа оплаты 

Событие клика для открытия главной страницы:
* mainpage:open - закрываем модальное окно и открываем главную страницу


* address:validation - событие, сообщающее о необходимости валидации формы с адресом
* email:validation - событие, сообщающее о необходимости валидации формы с почтой
* phone:validation - событие, сообщающее о необходимости валидации формы с телефоном
