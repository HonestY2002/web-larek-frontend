# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
- src/utils/items.ts — файл c массивом объектов товаров

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

1. Это объект который мы получаем с сервера. Мы не можем редактировать эти данные, но можем отображать объект используя эти данные interface Product { id: string; description: string; image: string; title: string; category: string; price: number;} 
 
2. Это пустой объект корзина, мы можем удалять и добалять товар в корзину, выбирать товар по id. interface  Basket предназначен для определения структуры и поведения объекта который будет использоваться в коде. Также в интерфейсе Basket будут храниться элементы массива items, каждый из которых является объектом Product. Методы addProduct и deleteProduct позволяют соответственно добавить продукт в корзину и удалить его.

3. interface ProductData  {это данные товаров, а также действия которые мы можем выполнять products: Product[]; preview: string | null;  это указатель на товар который мы хотим 
посмотреть getProduct(productId: string): Product;}
 
4. Это даннные пользователя которые будут вноситься в форму, валидироваться и сохраняться в модели данных.
interface UserData {payment: string; address: string; email: string; phone: string;  addData() добавляем данные в объект заказа checkValidation(data: Record<keyof OrderFormData, string>): boolean; делаем валидацию}

5. Это пустой объект заказа который мы будем отправлять на сервер interface Order {payment: string; email: string; phone: string; address: string;}

6. type PageProduct = Pick<Product, 'image' | 'title' | 'category' | 'price'> - позволяет получить данные о продукте, включая изображение, название, категорию, цену
    
7. type ProductPopup = Pick<Product, 'image' | 'title' | 'category' | 'price' | 'description'> - позволяет получить данные о продукте, включая изображение, название, категорию, цену и описание
    
8. type AddProduct = Pick<Product, 'id' | 'title' | 'price' > - Позволяет получить данные о продукте по его идентификатору и сохранить их в типе данных, который определяет свойства продукта
     
9. type ProductOrderPrice = Pick<Product, 'price'> - Здесь должна быть цена выбранного товара
    
10. type OrderFormData = Pick<Order, 'payment' | 'address' | 'email' | 'phone'> - Данные, вводимые в формы при оформлении заказа
    
11. type OrderProducts = Pick<Order, 'items'> - Список товаров, добавленных в корзину

## Архетиктура приложения

* Model (Модель) - часть приложения, которая работает с данными, проводит вычисления и руководит всеми бизнес-процессами.
* View (Вид или представление) - часть приложения, показывающая пользователю интерфейс и данные из модели на экране.
* Presenter (Представитель) - часть приложения, которая обеспечивает связь, является посредником между моделью и видом.

### Базовый код

#### Класс Api
     
В данном случае конструктор класса Api принимает два параметра: 
 * baseUrl: string — базовый URL для взаимодействия с API. 
 * options: RequestInit = {} — дополнительные параметры конфигурации запроса.

Поля класса
* readonly baseUrl: string — базовый URL для запросов.
* protected options: RequestInit — параметры запроса, такие как заголовки и метод.

Конструктор
Создаёт экземпляр класса с заданным базовым URL и параметрами запроса. Если параметр options не указан, используются значения по умолчанию: constructor(baseUrl: string, options: RequestInit = {})

В данном случае конструктор класса Api принимает два параметра: 
 * baseUrl: string — базовый URL для взаимодействия с API. 
 * options: RequestInit = {} — дополнительные параметры конфигурации запроса.
   
Метод handleResponse
Обрабатывает ответ от сервера. Если ответ успешный, возвращает ответ в формате JSON. Если нет, пытается получить ошибку из ответа и возвращает её или статус ответа в виде строки.

#### Класс EventEmitter

    Брокер событий, классическая реализация. В расширенных вариантах есть возможность подписаться на все события или слушать события по шаблону. Основные методы, реализуемые классом, описаны интерфейсом 'IEvents':

    interface IEvents {
        on(event: EventName, callback: (data: T) => void): void;
        emit<T extends object>(event: string, data?: T): void;
        trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}

### Model

#### ProductData
Класс отвечает за хранение и логику работы с данными товаров, отображаемых на странице и добавляемых в корзинку. 
Конструктор класса принимает брокер событий.

* _products: Product[] - массив объектов товаров
* _preview: string | null - id товара, выбранного для просмотра в модальном окне
* events: IEvent - экземпляр класса EventEmitter

В классе доступен набор методов для взаимодействия с этими данными.

* getProduct(productId: string): IProduct - возвращает товар по его id.

#### Класс Basket

Класс отвечает за хранение и логику работы с данными товаров, добавленных в корзину.
Данные товаров - это массив объектов товаров, их можно добавлять и удалять, а также подсчитывать общую стоимость товаров, добавленных в корзину.
Конструктор класса принимает брокер событий.

* _products: Product[] - массив товаров, добавленных в корзину
* events: IEvent - экземпляр класса EventEmitter

В классе доступен набор методов для взаимодействия с этими данными.

* addProduct(product: Product): 
* deleteProduct(productId: string, payload: Function | null): void 

#### Класс UserData

Класс отвечает за хранение и логику работы с данными, вводимыми в формы оформления заказа. Конструктор класса принимает инстант брокера событий.
В полях класса хранятся следущие данные:

payment: string;
email: string;
phone: string;
address: string;
Для взаимодействия с данными нам нужны такие методы:

addUserData - добавляем данные в объект данных пользователя.
clearUserData - удаляем данные из объекта данных пользователя
updateUserData - обновляем данные в объекте данных пользователя

### View

Все классы представляния отвечают за отображения внутри контейнера DOM-Element передаваемых в них данных.

#### Класс Component

Класс Component содержит защищённое свойство element, которое является элементом, с которым будет работать компонент. Все классы наследуются от Component.

#### Класс Modаl
Класс наследует класс Component, при этом добавляются элементы для открытия и закрытия модального окна.
Проанализировав верстку, у нас есть одно модальное окно, внутри которого размещается контент вызванного модального окна.

Внутри может находиться:

* div class="modal__container
* div class="card card_full карточка с полным описанием товара и - кнопка в корзину
* div class="basket" - корзина со всеми выбранными товарами и кнопка оформить
* form class="form"> - форма заполнения данных покупателя и кнопка далее
* form class="form"> - форма заполнения данных покупателя и кнопка оплатить
* div class="order-success"> - извещение об успешном оформлении заказа и кнопка перехода на главную страницу

Реализация происходит путем вставления в модальное окно таких шаблонов как:

* template id="success">
* template id="card-catalog">
* template id="card-preview">
* template id="card-basket">
* template id="basket">
* template id="order">
* template id="contacts"> - по нажатию определенной кнопки пользователем открываеться модальное окно в котором находиться DOM-element, так реализуется метод открытия модального окна(open)

Конструктор класса: 

* constructor(selector: string, events: IEvents) - конструктор принимает темплейт по которому в разметке страницы будет устанавливаться модальное окно и класс EventEmitter для разных событий.

В классе предоставляется метод close для управлением модального окна. Для закрытия модального окна устанавливаеться слушатель на кнопку ESC, на клик по оверлею и кнопку крестик.

Поля класса:
* events: IEvents - брокер событий
* close (): закрытие модального окна

#### Класс Form 

В классе есть возможности вводить данные, а также совершать с ними действия. Предназначен для реализации модального окна с формой, содержащей поля ввода. При клике(submit) инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Наследует класс Component. 


Методы для функциональноти кномпки сохранить и вывода ошибок:

* submitButton: HTMLButtonElement - кнопка подтверждения
* _form: HTMLFormElement - элемент формы
* formName: string - форма имени 
* inputs: NodeListOf - поля ввода формы
* errors: Record<string, HTMLElement> - объект, который хранит элементы вывода ошибок привязанный к атрибуту name

Методы:
* getValues(): Record<string, string> - возвращает объект с данными введенные пользователем
* setValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
* setError(data: { field: string, value: string, validInformation: string}): void - принимает объект с данными которые отображают или скрывают ошибки ввода
* showTextError (field: string, errorMessage: string): void - отоброжает текст самой оишибки
* hideError (field: string): void - очищает текст ошибки под указанным полем ввода
* setValid(isValid: boolean): void - изменяет активность кнопки подтверждения

#### Класс Product
Отвечает за отображение товара, отрисовывает данные названия, описания, изображения, цены. Класс используется для отображения товара на главной странице, в модальном окне и в корзине. В конструктор класса передается DOM элемент template для отрисовки конкретного отображения. Слушатель событий отслеживает, на какую карточку произошел кликю.
В классе доступен набор методов для взаимодействия с этими данными.

* getter id возвращает уникальный id выбранной карточки 
* setData(productData: Product): void - заполняет атрибуты элементов товара данными
* render(): HTMLElement - метод возвращает заполненный элемент товара

#### Класс ProductContainer
Отвечает за отбражения блока с карточками на главной странице или в корзине покупок. В конструктор принимает контейнер, в котором размещаются карточки. Предоставляет метод удаления карточки (для контейнера корзины). Здесь должен быть слушатель событий - для добавления карточек в корзину и удаления карточек из корзины. Setter container - для отображения товаров на главной странице или в корзине.

### Presenter

#### Класс AppData

Класс принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

**Список всех событий, которые могут генерироваться в системе:**
События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представления):
Событие клика по карточке товара: 
* product:open - выбор товара для просмотра в модальном окне
* product:select - добавление товара в корзину 

Событие клика по кнопке купить: 
*  product:add - добавляет товар для покупки

Событие клика по корзине на Главной странице:
* basket:select - открываем корзину для просмотра 
* basket:changed - изменение массива товаров в корзине 

События клика редактировария заказа:
* orderFormFirst:open - открытие первого модального окна с формой редактирования заказа
* orderFormSecond:open - открытие второго модального окна с формой редактирования заказа
* order:changed - изменение данных заказа
* order:submit - сохранение заказа по нажатию кнопки оплатить
* orderForm:clear - необходима очистка данных, введенных в форму

События клика для изменения данных в форме:
* address:input - изменение данных в форме с данными адреса
* email:input - изменение данных в форме с данными почты
* phone:input - изменение данных в форме с данными телефона

Событие клика для выбора сбособа оплаты:
* payWay:select - выбор способа оплаты 

Событие клика для открытия главной страницы:
* mainpage:open - закрываем модальное окно и открываем главную страницу


* address:validation - событие, сообщающее о необходимости валидации формы с адресом
* email:validation - событие, сообщающее о необходимости валидации формы с почтой
* phone:validation - событие, сообщающее о необходимости валидации формы с телефоном
